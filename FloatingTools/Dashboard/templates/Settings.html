<!DOCTYPE html>
<html lang="en">
<head>
    <title>Floating Tools - Settings</title>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <link rel="stylesheet" href="https://maxcdn.bootstrapcdn.com/bootstrap/3.3.7/css/bootstrap.min.css">
    <script src="https://ajax.googleapis.com/ajax/libs/jquery/3.2.0/jquery.min.js"></script>
    <script src="https://maxcdn.bootstrapcdn.com/bootstrap/3.3.7/js/bootstrap.min.js"></script>
</head>

<script>
function validateToolBox() {
    var e = document.getElementById("myToolbox");
    var strToolbox = e.options[e.selectedIndex].value;
    window.location = "/settings?myToolbox=" + strToolbox;
}

function setupToolBox() {
    var e = document.getElementById("myToolbox");
    var strToolbox = e.options[e.selectedIndex].value;
    window.location = "/setupToolbox?toolbox=" + strToolbox;
}

function addToolBoxPath() {
    var e = document.getElementById("myToolbox");
    var newPath = document.getElementById("NewPath");
    window.location = "/addToolboxPath?toolbox=" + e.options[e.selectedIndex].value + "&path=" + newPath.value;
}

function removeToolBoxPath() {
    var e = document.getElementById("myToolbox");
    var radios = document.getElementsByName('paths');

    for (var i = 0, length = radios.length; i < length; i++) {
        if (radios[i].checked) {
            window.location = "/addToolboxPath?toolbox=" + e.options[e.selectedIndex].value + "&path=" + radios[i].value + "&remove=True";
            break;
        }
    }
}

function addToolBoxPath() {
    var e = document.getElementById("myToolbox");
    var newPath = document.getElementById("NewPath");
    window.location = "/addToolboxPath?toolbox=" + e.options[e.selectedIndex].value + "&path=" + newPath.value;
}

function addToolBox() {
    var e = document.getElementById("myToolbox");
    var newPath = document.getElementById("NewPath");
    window.location = "/addToolboxPath?toolbox=" + e.options[e.selectedIndex].value + "&path=" + newPath.value;
}

function removeToolBox() {
    var e = document.getElementById("myToolbox");
    var radios = document.getElementsByName('paths');

    for (var i = 0, length = radios.length; i < length; i++) {
        if (radios[i].checked) {
            window.location = "/addToolboxPath?toolbox=" + e.options[e.selectedIndex].value + "&path=" + radios[i].value + "&remove=True";
            break;
        }
    }
}

</script>

<body>

<div id="AddPath" class="modal fade" role="dialog">
    <div class="modal-dialog">
        <div class="modal-content">
            <div class="modal-header">
                <button type="button" class="close" data-dismiss="modal">&times;</button>
                <h4 class="modal-title">Add new toolbox path</h4>
            </div>
            <div class="modal-body">
                <label>New Path:</label><input type="text" id="NewPath" class="form-control">
                <span class="help-block">/path/to/your/tools</span>
            </div>
            <div class="modal-footer">
                <button type="button" class="btn btn-default" onclick="addToolBoxPath()">Add</button>
            </div>
        </div>
    </div>
</div>

<div id="RemovePath" class="modal fade" role="dialog">
    <div class="modal-dialog">
        <div class="modal-content">
            <div class="modal-header">
                <button type="button" class="close" data-dismiss="modal">&times;</button>
                <h4 class="modal-title">Remove toolbox path</h4>
            </div>
            <div class="modal-body">
                <form id="ToRemove">
                    {% for path in myToolboxMap.paths %}
                    <input type="radio" name="paths" value={{ path }}/><label>{{ path }}</label>
                    <br>
                    {% endfor %}
                </form>
            </div>
            <div class="modal-footer">
                <button type="button" class="btn btn-default" onclick="removeToolBoxPath()">Remove</button>
            </div>
        </div>
    </div>
</div>

<div id="AddToolbox" class="modal fade" role="dialog">
    <div class="modal-dialog">
        <div class="modal-content">
            <div class="modal-header">
                <button type="button" class="close" data-dismiss="modal">&times;</button>
                <h4 class="modal-title">Add a network Toolbox</h4>
            </div>
            <div class="modal-body">
                <label>Toolbox Repository Path:</label><input type="text" id="NewToolbox" class="form-control">
                <span class="help-block">username/repository</span>
            </div>
            <div class="modal-footer">
                <button type="button" class="btn btn-default" onclick="addToolBox()">Add</button>
            </div>
        </div>
    </div>
</div>

<div class="container">
    <header>
        <h2>Floating Tools Settings</h2>
    </header>

    <div class="panel panel-info">
        <div class="panel-heading">
            <h4>My Toolbox</h4>
            <select class="form-control" id="myToolbox" onchange="validateToolBox()">
                {% for repository in myRepositories %}
                {% if repository.name == myToolbox %}
                <option value={{ repository.name }} selected="selected"> {{ repository.name }}</option>
                {% else %}
                <option value={{ repository.name }}> {{ repository.name }}</option>
                {% endif %}
                {% endfor %}
            </select>
        </div>
        <div class="panel-body">

            {% if myToolboxMap == False %}
            <input type="button" value="Set up {{ myToolbox }} as Toolbox" onclick="setupToolBox()">
            {% else %}
            {% for path in myToolboxMap.paths %}
            <input type="text" class="form-control" name="path{{ loop.index }}" value={{ path }}/>
            {% endfor %}
            {% endif %}

        </div>
        <div class="panel-footer">
            <input type="button" value="Add" data-toggle="modal" data-target="#AddPath">
            <input type="button" value="Remove" data-toggle="modal" data-target="#RemovePath">
        </div>
    </div>

    <div class="panel panel-info">
        <div class="panel-heading">
            <h4>Network Toolboxes</h4>
        </div>
        <div class="panel-body">
                {% for repository in repositories %}
            <label>
                {% if repository.load == True %}
                <input type="checkbox" name={{ repository.name }} checked/> {{ repository.name }}
                {% else %}
                <input type="checkbox" name={{ repository.name }}/> {{ repository.name }}
                {% endif %}
            </label>
            <br>
                {% endfor %}
        </div>
        <div class="panel-footer">
            <input type="button" value="Add" data-toggle="modal" data-target="#AddToolbox">
            <input type="button" value="Remove" data-toggle="modal" data-target="#RemoveToolbox">
        </div>
    </div>

    <footer>
        <input type="button" name="saveSettings" value="Save"/>
    </footer>
</div>

</body>
</html>